<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Sustainability Project</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h2 class="mb-4 text-center">Add Sustainability Project</h2>

      <form
        id="projectForm"
        enctype="multipart/form-data"
        class="card p-4 shadow"
      >
        <div class="mb-3">
          <label for="title" class="form-label">Project Title</label>
          <input
            type="text"
            class="form-control"
            id="title"
            name="title"
            required
          />
        </div>

        <div class="mb-3">
          <label for="departments" class="form-label"
            >Departments Involved</label
          >
          <input
            type="text"
            class="form-control"
            id="departments"
            name="departments"
            required
          />
        </div>

        <div class="mb-3">
          <label for="type" class="form-label">Project Type</label>
          <select id="type" name="type" class="form-control" required>
            <option value="Recycling">Recycling</option>
            <option value="Zero Waste">Zero Waste</option>
            <option value="Seminar">Seminar</option>
            <option value="Energy">Energy</option>
            <option value="Water">Water</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="image" class="form-label">Upload Picture</label>
          <input type="file" class="form-control" id="image" name="image" />
        </div>

        <div class="mb-3">
          <label for="description" class="form-label"
            >Project Description</label
          >
          <textarea
            class="form-control"
            id="description"
            name="description"
            rows="4"
            required
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="partners" class="form-label">External Partners</label>
          <input
            type="text"
            class="form-control"
            id="partners"
            name="partners"
          />
        </div>

        <div class="mb-3">
          <label for="responsiblePerson" class="form-label"
            >Responsible Person</label
          >
          <input
            type="text"
            class="form-control"
            id="responsiblePerson"
            name="responsiblePerson"
            required
          />
        </div>

        <div class="mb-3">
          <label for="responsibleEmail" class="form-label"
            >Responsible Email</label
          >
          <input
            type="email"
            class="form-control"
            id="responsibleEmail"
            name="responsibleEmail"
            required
          />
        </div>

        <div class="mb-3">
          <label for="year" class="form-label">Year Initiated</label>
          <input
            type="number"
            class="form-control"
            id="year"
            name="year"
            min="2000"
            max="2100"
            required
          />
        </div>

        <div class="mb-3">
          <label for="status" class="form-label">Project Status</label>
          <select id="status" name="status" class="form-control" required>
            <option value="Ongoing">Ongoing</option>
            <option value="Finished">Finished</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="location" class="form-label">Project Location</label>
          <input
            type="text"
            class="form-control"
            id="location"
            name="location"
            required
          />
        </div>

        <button type="submit" class="btn btn-success w-100">Add Project</button>
      </form>

      <div id="message" class="mt-3"></div>
    </div>

    <script>
      document
        .getElementById("projectForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const formData = new FormData(this);

          try {
            console.log("üì§ Sending form data to server...");
            const response = await fetch(
              "http://localhost:5000/api/projects/add",
              {
                method: "POST",
                credentials: "include", // Include session cookies for authentication
                body: formData,
              }
            );

            const result = await response.json();
            const messageBox = document.getElementById("message");

            if (response.ok) {
              console.log("‚úÖ Project created successfully:", result);
              messageBox.innerHTML = `<div class="alert alert-success">${result.message}</div>`;
              this.reset();
            } else {
              console.error("‚ùå Failed to create project:", result.error);
              messageBox.innerHTML = `<div class="alert alert-danger">${result.error}</div>`;
            }
          } catch (err) {
            console.error("üö® Network or server error:", err);
            document.getElementById(
              "message"
            ).innerHTML = `<div class="alert alert-danger">Server error. Check the console.</div>`;
          }
        });
    </script>
  </body>
</html>
